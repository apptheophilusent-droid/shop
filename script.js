const products = [
  {
    id: 1,
    name: "",
    price: 45.0,
    image:
      "1.jpg",
  },
  {
    id: 2,
    name: "",
    price: 60.0,
    image:
      "2.jpg",
  },
  {
    id: 3,
    name: "",
    price: 38.0,
    image:
      "3.jpg",
  },
  {
    id: 4,
    name: " ",
    price: 25.0,
    image:
      "4.jpg",
  },
  {
    id: 5,
    name: "",
    price: 55.0,
    image:
      "5.jpg",
  },
  {
    id: 6,
    name: "",
    price: 55.0,
    image:
      "6.jpg",
  },
  {
    id: 7,
    name: " ",
    price: 55.0,
    image:
      "7.jpg",
  },
  {
    id: 8,
    name: "",
    price: 55.0,
    image:
      "8.jpg",
  },
  {
    id: 9,
    name: "",
    price: 55.0,
    image:
      "9.jpg",
  },
  {
    id: 10,
    name: "",
    price: 55.0,
    image:
      "10.jpg",
  },
  {
    id: 11,
    name: "",
    price: 55.0,
    image:
      "11.jpg",
  },
  {
    id:12 ,
    name: "",
    price: 55.0,
    image:
      "12.jpg",
  },
   {
    id:13 ,
    name: "",
    price: 55.0,
    image:
      "13.jpg",
  },
   {
    id:14 ,
    name: "",
    price: 55.0,
    image:
      "14.jpg",
  },
  {
    id:15 ,
    name: "",
    price: 55.0,
    image:
      "15.jpg",
  },
  {
    id:16 ,
    name: "",
    price: 55.0,
    image:
      "16.jpg",
  },
  {
    id:17 ,
    name: "",
    price: 55.0,
    image:
      "17.jpg",
  }, 
  {
    id:18 ,
    name: "",
    price: 55.0,
    image:
      "18.jpg",
  },
  {
    id:19 ,
    name: "",
    price: 55.0,
    image:
      "19.jpg",
  },
  {
    id:20 ,
    name: "",
    price: 55.0,
    image:
      "20.jpg",
  },
  {
    id:21 ,
    name: "",
    price: 55.0,
    image:
      "21.jpg",
  },
  {
    id:22 ,
    name: "",
    price: 55.0,
    image:
      "22.jpg",
  },
  {
    id:23 ,
    name: "",
    price: 55.0,
    image:
      "23.jpg",
  },
  {
    id:24 ,
    name: "",
    price: 55.0,
    image:
      "24.jpg",
  },
  {
    id:25 ,
    name: "",
    price: 55.0,
    image:
      "25.jpg",
  },
  {
    id:26 ,
    name: "",
    price: 55.0,
    image:
      "26.jpg",
  },
  {
    id:27 ,
    name: "",
    price: 55.0,
    image:
      "27.jpg",
  },
  {
    id:28 ,
    name: "",
    price: 55.0,
    image:
      "28.jpg",
  },
  {
    id:29 ,
    name: "",
    price: 55.0,
    image:
      "29.jpg",
  },
  {
    id:30 ,
    name: "",
    price: 55.0,
    image:
      "30.jpg",
  },
  {
    id:31 ,
    name: "",
    price: 55.0,
    image:
      "31.jpg",
  },
  {
    id:32 ,
    name: "",
    price: 55.0,
    image:
      "32.jpg",
  },
  {
    id:33 ,
    name: "",
    price: 55.0,
    image:
      "33.jpg",
  },
  {
    id:34 ,
    name: "",
    price: 55.0,
    image:
      "34.jpg",
  },
  {
    id:35 ,
    name: "",
    price: 55.0,
    image:
      "35.jpg",
  },
  {
    id:36 ,
    name: "",
    price: 55.0,
    image:
      "36.jpg",
  },
  {
    id:37 ,
    name: "",
    price: 55.0,
    image:
      "37.jpg",
  },
  {
    id:38 ,
    name: "",
    price: 55.0,
    image:
      "38.jpg",
  },
  {
    id:39 ,
    name: "",
    price: 55.0,
    image:
      "39.jpg",
  },
  {
    id:40 ,
    name: "",
    price: 55.0,
    image:
      "40.jpg",
  },
  {
    id:41 ,
    name: "",
    price: 55.0,
    image:
      "41.jpg",
  },
  {
    id:42 ,
    name: "",
    price: 55.0,
    image:
      "42.jpg",
  }, 
  {
    id:43 ,
    name: "",
    price: 55.0,
    image:
      "43.jpg",
  },
  {
    id:44 ,
    name: "",
    price: 55.0,
    image:
      "44.jpg",
  }, 
  {
    id:45 ,
    name: "",
    price: 55.0,
    image:
      "45.jpg",
  },
  {
    id:46 ,
    name: "",
    price: 55.0,
    image:
      "46.jpg",
  },
  {
    id:47 ,
    name: "",
    price: 55.0,
    image:
      "47.jpg",
  },
  {
    id:48 ,
    name: "",
    price: 55.0,
    image:
      "48.jpg",
  },
  {
    id:49 ,
    name: "",
    price: 55.0,
    image:
      "49.jpg",
  },
  {
    id:50 ,
    name: "",
    price: 55.0,
    image:
      "50.jpg",
  },
  {
    id:51 ,
    name: "",
    price: 55.0,
    image:
      "51.jpg",
  },
  {
    id:52 ,
    name: "",
    price: 55.0,
    image:
      "52.jpg",
  },
  {
    id:53 ,
    name: "",
    price: 55.0,
    image:
      "53.jpg",
  },
  {
    id:54 ,
    name: "",
    price: 55.0,
    image:
      "54.jpg",
  },
  {
    id:55 ,
    name: "",
    price: 55.0,
    image:
      "55.jpg",
  },
  {
    id:56 ,
    name: "",
    price: 55.0,
    image:
      "56.jpg",
  },
  {
    id:57 ,
    name: "",
    price: 55.0,
    image:
      "57.jpg",
  },
  {
    id:58 ,
    name: "",
    price: 55.0,
    image:
      "58.jpg",
  },
  {
    id:59 ,
    name: "",
    price: 55.0,
    image:
      "59.jpg",
  },
];

// Cart state
let cart = JSON.parse(localStorage.getItem("cart")) || [];

const productsContainer = document.getElementById("products");
const cartSection = document.getElementById("cart-section");
const cartItemsContainer = document.getElementById("cart-items");
const cartTotalEl = document.getElementById("cart-total");
const btnCheckout = document.getElementById("btn-checkout");
const orderSection = document.getElementById("order-section");
const orderForm = document.getElementById("order-form");
const toast = document.getElementById("toast");

// Toggle Cart Panel
document.getElementById("toggle-cart").addEventListener("click", () => {
  cartSection.classList.toggle("open");
});
document.getElementById("close-cart").addEventListener("click", () => {
  cartSection.classList.remove("open");
});

// Save cart to localStorage
function saveCartToStorage() {
  localStorage.setItem("cart", JSON.stringify(cart));
}

// Show toast
function showToast(message = "Added to cart 🛍️") {
  toast.textContent = message;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 3000);
}

// Render Products
function renderProducts() {
  productsContainer.innerHTML = "";
  products.forEach((product) => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.innerHTML = `
      <img src="${product.image}" loading="lazy" alt="${product.name}" />
      <div class="product-info">
        <div>
          <h3 class="product-name">${product.name}</h3>
          <p class="product-price">₵${product.price.toFixed(2)}</p>
        </div>
        <button class="btn-add" data-id="${product.id}">Add to Cart</button>
      </div>
    `;
    productsContainer.appendChild(card);
  });
}

// Render Cart
function renderCart() {
  if (cart.length === 0) {
    cartItemsContainer.innerHTML = `
      <p>Your cart is empty.</p>
      <button onclick="cartSection.classList.remove('open')" class="btn-clear">Browse Products</button>
    `;
    cartTotalEl.textContent = "0.00";
    btnCheckout.disabled = true;
    return;
  }

  btnCheckout.disabled = false;
  cartItemsContainer.innerHTML = "";

  cart.forEach((item) => {
    const product = products.find((p) => p.id === item.id);
    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `
      <div class="cart-item-name">${product.name}</div>
      <div class="cart-item-qty">
        <button class="btn-decrease" data-id="${item.id}">−</button>
        <span>${item.qty}</span>
        <button class="btn-increase" data-id="${item.id}">+</button>
      </div>
      <div class="cart-item-price">₵${(product.price * item.qty).toFixed(2)}</div>
    `;
    cartItemsContainer.appendChild(div);
  });

  const total = cart.reduce((sum, item) => {
    const p = products.find((prod) => prod.id === item.id);
    return sum + p.price * item.qty;
  }, 0);

  cartTotalEl.textContent = total.toFixed(2);
}

// Add to Cart
productsContainer.addEventListener("click", (e) => {
  if (!e.target.classList.contains("btn-add")) return;
  const id = Number(e.target.dataset.id);
  const item = cart.find((i) => i.id === id);

  if (item) {
    item.qty++;
  } else {
    cart.push({ id, qty: 1 });
  }

  saveCartToStorage();
  renderCart();
  showToast();
});

// Cart Quantity Buttons
cartItemsContainer.addEventListener("click", (e) => {
  const id = Number(e.target.dataset.id);
  const item = cart.find((i) => i.id === id);

  if (e.target.classList.contains("btn-increase")) {
    item.qty++;
  } else if (e.target.classList.contains("btn-decrease")) {
    item.qty--;
    if (item.qty <= 0) {
      cart = cart.filter((i) => i.id !== id);
    }
  }

  saveCartToStorage();
  renderCart();
});

// Checkout button
btnCheckout.addEventListener("click", () => {
  cartSection.classList.remove("open");
  orderSection.style.display = "block";
  window.scrollTo({ top: orderSection.offsetTop, behavior: "smooth" });
});

// Submit order
orderForm.addEventListener("submit", function (e) {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();

  if (!name || !phone || !address) {
    alert("Please fill in all fields.");
    return;
  }

  const totalAmount = cart.reduce((sum, item) => {
    const product = products.find((p) => p.id === item.id);
    return sum + product.price * item.qty;
  }, 0);

  FlutterwaveCheckout({
    public_key: "FLWPUBK_TEST-xxxxxxxxxxxxxxxxxxxxx-X",
    tx_ref: "mybrand-" + Date.now(),
    amount: totalAmount,
    currency: "USD",
    customer: { email: "customer@example.com", phonenumber: phone, name },
    callback: (data) => {
      alert("Payment complete! Transaction ID: " + data.transaction_id);
      cart = [];
      saveCartToStorage();
      renderCart();
      orderForm.reset();
      orderSection.style.display = "none";
    },
    onclose: () => {
      alert("Payment was cancelled");
    },
    customizations: {
      title: "MyBrand Fashion Store",
      description: "Order Payment",
      logo: "https://via.placeholder.com/100x50?text=MyBrand",
    },
  });
});

// Initial Render
renderProducts();
renderCart();
